<!DOCTYPE html>
<html>
<head>
    <title>Feed de Receitas - Saborize</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>Feed de Receitas - Saborize</h1>

    <!-- Informa√ß√µes do usu√°rio -->
    <div>
        {% if user.is_authenticated %}
            <p>Bem-vindo, <strong>{{ user.username }}</strong>! 
            <a href="{% url 'listar_receitas' %}">Minhas Receitas</a> |
            <a href="{% url 'criar_receita' %}">Criar Receita</a> |
            <a href="{% url 'logout' %}">Logout</a></p>
        {% else %}
            <p>Bem-vindo ao Saborize! 
            <a href="{% url 'paginaLogin' %}">Fazer Login</a> |
            <a href="{% url 'registrarUser' %}">Registrar-se</a></p>
        {% endif %}
    </div>

    <!-- Filtros de busca e ordena√ß√£o -->
    <form method="GET">
        <div>
            <input type="text" name="busca" value="{{ busca }}" placeholder="Buscar receitas...">
            <select name="ordem">
                {% for valor, nome in opcoes_ordenacao %}
                    <option value="{{ valor }}" {% if ordenacao == valor %}selected{% endif %}>{{ nome }}</option>
                {% endfor %}
            </select>
            <button type="submit">Filtrar</button>
        </div>
        {% if busca %}
            <a href="{% url 'feed_receitas' %}">Limpar busca</a>
        {% endif %}
    </form>

    <p><strong>Total:</strong> {{ total_receitas }} receita{{ total_receitas|pluralize }}</p>

        <!-- Lista de receitas -->
            <!-- Lista de receitas -->
    <div>
        {% for receita in receitas %}
            <div>
                <h3><a href="{% url 'ver_receita_feed' receita.id %}">{{ receita.titulo }}</a></h3>
                
                <p><strong>Por:</strong> {{ receita.user.username }} | <strong>Publicada em:</strong> {{ receita.criada_em|date:"d/m/Y H:i" }}</p>
                
                <p>{{ receita.descricao|truncatewords:30 }}</p>
                
                <!-- Estat√≠sticas -->
                <div>
                    {% if receita.total_avaliacoes > 0 %}
                        <span><strong>‚òÖ {{ receita.media_bayesiana }}/5</strong></span> 
                        <span>({{ receita.total_avaliacoes }} avalia√ß√£o{{ receita.total_avaliacoes|pluralize:"√µes" }})</span>
                    {% else %}
                        <span>Sem avalia√ß√µes</span>
                    {% endif %}
                    <span> | {{ receita.total_comentarios }} coment√°rio{{ receita.total_comentarios|pluralize:"s" }}</span>
                </div>
                
                <!-- A√ß√µes -->
                <div>
                    <a href="{% url 'ver_receita_feed' receita.id %}">Ver Receita Completa</a>
                    
                    {% if user.is_authenticated %}
                        <a href="{% url 'fazer_comentario' receita.id %}">Comentar</a>
                    {% else %}
                        <a href="{% url 'paginaLogin' %}?next={% url 'fazer_comentario' receita.id %}">Login para Comentar</a>
                    {% endif %}
                </div>
                <hr>
            </div>
        {% empty %}
            <div>
                <h3>Nenhuma receita encontrada</h3>
                {% if busca %}
                    <p>Nenhuma receita encontrada para "{{ busca }}".</p>
                    <a href="{% url 'feed_receitas' %}">Ver todas as receitas</a>
                {% else %}
                    <p>Ainda n√£o h√° receitas p√∫blicas. 
                    {% if user.is_authenticated %}
                        <a href="{% url 'criar_receita' %}">Seja o primeiro a criar uma!</a>
                    {% else %}
                        <a href="{% url 'registrarUser' %}">Registre-se para criar receitas!</a>
                    {% endif %}
                    </p>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    
    <!-- Pagina√ß√£o -->
    {% if receitas.has_other_pages %}
        <div>
            {% if receitas.has_previous %}
                <a href="?page={{ receitas.previous_page_number }}{% if busca %}&busca={{ busca }}{% endif %}{% if ordenacao %}&ordem={{ ordenacao }}{% endif %}">&laquo; Anterior</a>
            {% endif %}
            
            <span>P√°gina {{ receitas.number }} de {{ receitas.paginator.num_pages }}</span>
            
            {% if receitas.has_next %}
                <a href="?page={{ receitas.next_page_number }}{% if busca %}&busca={{ busca }}{% endif %}{% if ordenacao %}&ordem={{ ordenacao }}{% endif %}">Pr√≥xima &raquo;</a>
            {% endif %}
        </div>
    {% endif %}
    
    <!-- Footer -->
    <hr>
    <div>
        <p>Saborize - Compartilhe suas receitas favoritas!</p>
        {% if not user.is_authenticated %}
            <p><a href="{% url 'registrarUser' %}">Crie sua conta gratuita</a> para compartilhar suas pr√≥prias receitas.</p>
        {% endif %}
    </div>

</body>
</html>
        
        <!-- Pagina√ß√£o -->
        {% if receitas.has_other_pages %}
            <div style="text-align: center; margin-top: 30px;">
                {% if receitas.has_previous %}
                    <a href="?page={{ receitas.previous_page_number }}{% if busca %}&busca={{ busca }}{% endif %}{% if ordenacao %}&ordem={{ ordenacao }}{% endif %}" 
                       style="background-color: #6c757d; color: white; padding: 8px 12px; text-decoration: none; margin: 0 5px; border-radius: 4px;">&laquo; Anterior</a>
                {% endif %}
                
                <span style="margin: 0 15px; font-weight: bold;">
                    P√°gina {{ receitas.number }} de {{ receitas.paginator.num_pages }}
                </span>
                
                {% if receitas.has_next %}
                    <a href="?page={{ receitas.next_page_number }}{% if busca %}&busca={{ busca }}{% endif %}{% if ordenacao %}&ordem={{ ordenacao }}{% endif %}" 
                       style="background-color: #6c757d; color: white; padding: 8px 12px; text-decoration: none; margin: 0 5px; border-radius: 4px;">Pr√≥xima &raquo;</a>
                {% endif %}
            </div>
        {% endif %}
        
        <!-- Footer -->
        <hr style="margin-top: 40px;">
        <div style="text-align: center; padding: 20px; color: #666;">
            <p>üçΩÔ∏è Saborize - Compartilhe suas receitas favoritas!</p>
            {% if not user.is_authenticated %}
                <p><a href="{% url 'registrarUser' %}" style="color: #007bff; text-decoration: none;">Crie sua conta gratuita</a> para compartilhar suas pr√≥prias receitas.</p>
            {% endif %}
        </div>
    </div>

